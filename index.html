<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Canvas Spritter</title>
</head>
<style>
    canvas {
        border: 1px solid black;
    }

    #binpackcanvas {
        width: 512px;
        height: 512px;
    }
</style>
<body>
    <h3>Canvas Spritter</h3>
    <hr>
    <canvas id='canvas' width='480' height='360'></canvas>
    <pre id='status'>Hi!</pre>

    <canvas id='binpackcanvas' width='2048' height='2048'></canvas>

    <script type='module'>

    import Spritter from './src/spritter.js';
    import Helpers from './src/helpers.js';
    import BinPacker from './src/bin_packer.js';

    globalThis.Helpers = Helpers;

    let canvas = document.getElementById('canvas');
    let spritter = null;

    async function main()
    {
        if (!navigator.gpu)
            throw "WebGPU not supported";

        const adapter = await navigator.gpu.requestAdapter();
        if (!adapter)
            throw "Couldn't get adapter";

        const device = await adapter.requestDevice({
            requiredFeatures: [
                ['timestamp-query']
            ]
        });

        console.log('device success');

        spritter = new Spritter(canvas, device);
        await spritter.init();

        async function loop() {
            await spritter.draw();
            requestAnimationFrame(loop);
        }

        loop();
    }

    main();

    // BinPacker.Test();

    </script>

</body>
</html>